/*! upgF2E - v0.1.0 
* https://www.yrz.cn/
* Copyright (c) 2014 Front-End development team of UPG Cloud Financing Department; Licensed MIT */
define("area/area",[],function(a,b){function c(){$("[area]").each(function(){var a=$(this);if(!a.data("initArea")){a.data("initArea","1");var b=a.attr("area-select"),c=a.attr("area-open"),d=a.attr("area-options")||{};d=$.parseJSON(d)||{},b&&(d.onSelect=b),c&&(d.onOpen=c),a.acCity(d)}})}!function(a){a.acCity=a.fn.acCity=function(b){var c,d={url:"/index.php/Financing/CorpFinancing/api_area_by_cname",onSelect:!1,onOpen:!1,defaultVal:{province:"1013",city:"1014",area:"0"},fieldName:{province_id:"province_id",city_id:"city_id",dict_area_id:"dict_area_id"},noSwitch:!1,startupSwitch:!1,maxSwitchAreaType:4,switchAreaTypeRequiredLevel:2,noSelectedOption:!1},e=this,f=a(this);b=b||{},c=a.extend({},d,b);var g=!1,h=a('<input name="country_id" type="hidden" value="1"/>'),i=a('<input name="'+c.fieldName.province_id+'" type="hidden"/>'),j=a('<input name="'+c.fieldName.city_id+'" type="hidden"/>'),k=a('<input name="'+c.fieldName.dict_area_id+'" type="hidden"/>'),l=a('<input name="area_country" type="hidden" value="中国"/>'),m=a('<input name="area_province" type="hidden"/>'),n=a('<input name="area_city" type="hidden"/>'),o=a('<input name="area_dict_area" type="hidden"/>');f.siblings("input[name='country_id']").length&&(h=f.siblings("input[name='country_id']"),g=!0),f.siblings("input[name='"+c.fieldName.province_id+"']").length&&(i=f.siblings("input[name='"+c.fieldName.province_id+"']"),g=!0),f.siblings("input[name='"+c.fieldName.city_id+"']").length&&(j=f.siblings("input[name='"+c.fieldName.city_id+"']"),g=!0),f.siblings("input[name='"+c.fieldName.dict_area_id+"']").length&&(k=f.siblings("input[name='"+c.fieldName.dict_area_id+"']"),g=!0),f.siblings("input[name='area_country']").length&&(l=f.siblings("input[name='area_country']"),g=!0),f.siblings("input[name='area_province']").length&&(m=f.siblings("input[name='area_province']"),g=!0),f.siblings("input[name='area_city']").length&&(n=f.siblings("input[name='area_city']"),g=!0),f.siblings("input[name='area_dict_area']").length&&(o=f.siblings("input[name='area_dict_area']"),g=!0);var p=a("<select/>").addClass("input_common mr10").css("width","80px").attr("areaType","2"),q=a("<select/>").addClass("input_common mr10").css("width","80px").attr("areaType","3"),r=a("<select/>").addClass("input_common").css("width","80px").attr("areaType","4");c.maxSwitchAreaType<4&&r.hide(),f.bind("blur.acCity",function(){0==f.val().length&&(i.val(""),m.val(""),j.val(""),k.val(""),n.val(""),o.val("")),setTimeout(function(){k.val()||f.val("").trigger("change").autocomplete("search","")},200)}),c.noSwitch&&(c.url=c.url+"&noSwitch=1"),f.autocomplete({source:c.url,autoFocus:!0,search:function(){i.val(""),m.val(""),j.val(""),k.val(""),n.val(""),o.val("")},select:function(a,b){if("-1"==b.item.value?setTimeout(e.switchCitySearch,0):"-2"==b.item.value||(f.val(b.item.city_name),h.val(b.item.country_id),i.val(b.item.province_id),j.val(b.item.city_id),l.val(b.item.country_name),m.val(b.item.province_name),n.val(b.item.city_name),b.item.area_id&&(k.val(b.item.area_id),o.val(b.item.area_name),f.val(b.item.city_name+b.item.area_name))),c.onSelect){var d=c.onSelect;d=window[c.onSelect],"function"==typeof d&&d(b.item,f,a)}return!1},open:function(a){if(f.autocomplete("widget").css("zIndex",upgTool.getHighestZIndex()+1),c.onOpen){var b=c.onOpen;b=window[c.onOpen],"function"==typeof b&&b(a,f.autocomplete("widget"),f)}}}),g||f.after(h).after(i).after(j).after(k).after(l).after(m).after(n).after(o),e.switchCitySearch=function(){upgTool.removeErrorMsg(f),p.add(q).change(function(){var b=a(this);e.fillValueFromSelect(b),e.getNextArea(b.val(),b.attr("areaType"))}),r.change(function(){e.fillValueFromSelect(a(this))}),f.replaceWith(p),p.after(r).after(q),e.getNextArea(1,1,!0)},e.fillValueFromSelect=function(b){var c=b.attr("areaType"),d=b.val(),e=d?a("option:selected",b).text():"";"2"==c?(i.val(d),m.val(e),j.val(""),k.val(""),n.val(""),o.val("")):"3"==c?(j.val(d),n.val(e),k.val(""),o.val("")):"4"==c&&(k.val(d),o.val(e))},e.getNextArea=function(b,d,f){a("option",r).remove(),2>=d&&(c.switchAreaTypeRequiredLevel<=2?a("option:gt(0)",q).remove():a("option",q).remove()),1>=d&&(c.switchAreaTypeRequiredLevel<=1?a("option:gt(0)",p).remove():a("option",p).remove());var g=p,h=c.defaultVal.province;c.noSelectedOption&&0==a("option",g).length&&g.append("<option value=''>---省---</option>"),2==d?(g=q,c.noSelectedOption&&0==a("option",g).length&&g.append("<option value=''>---市---</option>"),h=c.defaultVal.city):3==d&&(g=r,c.noSelectedOption&&0==a("option",g).length&&g.append("<option value=''>---区域---</option>"),h=c.defaultVal.area),2==d&&0==a("option",g).length&&c.switchAreaTypeRequiredLevel<=2&&g.append('<option value="">---市---</option>'),3==d&&0==a("option",g).length&&c.switchAreaTypeRequiredLevel<=3&&g.append('<option value="">---区域---</option>'),b&&a.post("/index.php/Financing/CorpFinancing/api_area_by_code",{id:b,area_type:d},function(i){if("1"==i.boolen){var j=i.data;a.each(j,function(){var b=a("<option/>").attr("title",this.name_cn).text(this.name_cn).attr("value",this.id);g.append(b),this.id==h&&b.prop("selected",!0),e.fillValueFromSelect(g)}),2>=d&&(f?b=h:c.switchAreaTypeRequiredLevel>d&&(b=g.val()),e.getNextArea(b,parseInt(d)+1,f))}},"json")},(b.defaultVal||b.startupSwitch)&&e.switchCitySearch()}}(jQuery),b.init=c});