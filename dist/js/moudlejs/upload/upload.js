/*! fedframe - v0.1.0 
* https://www.yrz.cn/
* Copyright (c) 2014 Front-End development team of UPG Cloud Financing Department; Licensed MIT */
define("upload/upload",["ajaxform/ajaxform","tipsy/tipsy","validate/validate"],function(a,b){a.async("./upload.css"),a("ajaxform/ajaxform");var c=function(a){var b=this;b.uploadBtn=a.uploadBtn,b.btnText=a.btnText||"上传",b.btnWidth=a.btnWidth||$(b.uploadBtn).width()+"px",b.btnHeight=a.btnHeight||$(b.uploadBtn).height()+"px",b.uploadService=a.uploadService,b.uploadParams=a.uploadParams,b.uploadBeforeFun=a.uploadBeforeFun||function(){},b.uploadSuccessFun=a.uploadSuccessFun,b.uploadErrorFun=a.uploadErrorFun||function(){},b.debug=a.debug,b.init()};c.prototype={constructor:c,init:function(){var a=this;return a.uploadBtn?void a.updateBtn():(a.console("实例化时的参数异常！"),!1)},updateBtn:function(){var a=this,b=a.uploadBtn;b.css({position:"relative",overflow:"hidden",width:a.btnWidth,height:a.btnHeight,textAlign:"center"});var c=a.createFileInput();b.html(a.btnText).append(c)},createFileInput:function(){var a=this,b=$("<input/>").attr({name:"publicUpload",type:"file",id:"uploadFile",now:(new Date).getTime()});return b.css({position:"absolute",left:0,top:0,opacity:0,cursor:"pointer",width:a.btnWidth,height:a.btnHeight,overflow:"hidden"}),b.change(function(){var b=$(this);a.upload(b)}),b},upload:function(a){var b=this,c=$(a),d=b.getDocType(c);if(!d)return b.console("请传入合法的文件！"),!1;var e=$("<input/>").attr({name:"attach_type",type:"hidden",value:d});$("form#publicAttachUploadForm").remove();var f=$("<form/>").attr("id","publicAttachUploadForm").attr("enctype","multipart/form-data").attr("method","post").attr("action",b.uploadService).hide();f.append(c).append(e);for(var g in b.uploadParams)b.uploadParams.hasOwnProperty(g)&&f.append('<input type="hidden" name="'+g+'" value="'+b.uploadParams[g]+'" />');var h={beforeSubmit:b.uploadBeforeFun.bind(b),error:b.uploadErrorFun.bind(b),success:b.success.bind(b)};f.appendTo("body").submit(function(){return $(this).ajaxSubmit(h),!1}),f.submit()},success:function(a){var b=this;return b.updateBtn(),a?b.uploadSuccessFun?void b.uploadSuccessFun.call(b,a):void 0:(b.console("服务端未返回相关附件信息！"),!1)},resizePop:function(a){var b=$(a);b.parents("#colorbox").length?$.colorbox.resize():b.parents("#box2").length?$.box2.resize():b.parents("#box3").length&&$.box3.resize()},getDocType:function(a){var b=$(a),c=b.val(),d="jpg,gif,png,jpeg",e="bmp,zip,rar,doc,xls,ppt,docx,xlsx,pptx,pdf,txt,html,htm,wps,et,dps",f="mp3,wma,flac,aac,mmf,amr,m4a,m4r,ogg,mp2,wav,wv",g="ra,wma,mp4,mp3,rm,rmvb,wmv,mov",h={img:d,file:e,sound:f,media:g},i=c.slice(c.lastIndexOf(".")+1).toLowerCase(),j=!1;for(var k in h)if(h.hasOwnProperty(k)&&-1!==h[k].indexOf(i)){j=k;break}return j},console:function(a){var b=this;window.console&&b.debug&&console.error(a)}},b.init=c});